<!DOCTYPE html>
<html lang="">
  <head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="使用webpack构建项目"/>




  <meta name="keywords" content="js,webpack,tool," />




  <link rel="alternate" href="/atom.xml" title="m.l 's blog">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.1.x" />



<link rel="canonical" href="http://mlxiao.com/2017/02/08/webpack/"/>


<meta name="description" content="此文基于webpack2，做为个人稳定使用的一套webpack配置，记录下来，以供参考。查看源码">
<meta property="og:type" content="article">
<meta property="og:title" content="使用webpack构建项目">
<meta property="og:url" content="http://mlxiao.com/2017/02/08/webpack/index.html">
<meta property="og:site_name" content="m.l 's blog">
<meta property="og:description" content="此文基于webpack2，做为个人稳定使用的一套webpack配置，记录下来，以供参考。查看源码">
<meta property="og:image" content="http://o86lf0oxm.bkt.clouddn.com/webpack-concept.svg">
<meta property="og:image" content="http://o86lf0oxm.bkt.clouddn.com/webpack-demo-01.png">
<meta property="og:image" content="http://o86lf0oxm.bkt.clouddn.com/webpack-demo-03.png">
<meta property="og:updated_time" content="2017-03-13T05:51:25.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="使用webpack构建项目">
<meta name="twitter:description" content="此文基于webpack2，做为个人稳定使用的一套webpack配置，记录下来，以供参考。查看源码">
<meta name="twitter:image" content="http://o86lf0oxm.bkt.clouddn.com/webpack-concept.svg">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.1.x" />



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />




  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?b749a7ec8f4ce4e8913350bbc7a424d8";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




    <title> 使用webpack构建项目 · m.l 's blog </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  </head>

  <body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">m.l 's blog</a>
</div>

<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              Home
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              Archives
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags">
            
            
              Tags
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/about">
            
            
              About
            
          </a>
        </li>
      
      
        <li class="menu-search">
          <form>
            <i class="iconfont icon-search" id="open-search"></i>
            <input type="text" class="search-input" id="search-input" />
            <i class="iconfont icon-close" id="close-search"></i>
          </form>
        </li>
      
    </ul>
  
</nav>

<div class="mobile-navbar">
  <div class="mobile-header">
    <div class="mobile-header-logo">
      <a href="/." class="logo">m.l 's blog</a>
    </div>

    <div class="mobile-header-icon">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>
  <nav class="mobile-menu">
    
      <a class="mobile-menu-item" href="/">
        
        
          Home
        
      </a>
    
      <a class="mobile-menu-item" href="/archives/">
        
        
          Archives
        
      </a>
    
      <a class="mobile-menu-item" href="/tags">
        
        
          Tags
        
      </a>
    
      <a class="mobile-menu-item" href="/about">
        
        
          About
        
      </a>
    
  </nav>
</div>
      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          使用webpack构建项目
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          Feb 8, 2017
        </span>
      </div>
    </header>

    
      <div class="post-toc" id="post-toc">
        <h2 class="post-toc-title">Contents</h2>
        <div class="post-toc-content">
          <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#webpack概念"><span class="toc-text">webpack概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#构建流程"><span class="toc-text">构建流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#环境要求"><span class="toc-text">环境要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#项目初始化"><span class="toc-text">项目初始化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建项目"><span class="toc-text">创建项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#引入webpack2"><span class="toc-text">引入webpack2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#项目初始结构分析"><span class="toc-text">项目初始结构分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#开始写webpack-config"><span class="toc-text">开始写webpack config</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#编写npm-scripts，区分环境"><span class="toc-text">编写npm scripts，区分环境</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#从dev环境写起"><span class="toc-text">从dev环境写起</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#webpack-dev-server"><span class="toc-text">webpack-dev-server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#htmlWebpackPlugins"><span class="toc-text">htmlWebpackPlugins</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Loaders-Rules"><span class="toc-text">Loaders(Rules)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ES6-支持"><span class="toc-text">ES6+支持</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#css处理"><span class="toc-text">css处理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#html模板、图片等的处理"><span class="toc-text">html模板、图片等的处理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置production环境"><span class="toc-text">配置production环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#抽出公共部分"><span class="toc-text">抽出公共部分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#production环境的其它处理"><span class="toc-text">production环境的其它处理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#使用UglifyJsPlugin压缩js"><span class="toc-text">使用UglifyJsPlugin压缩js</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#使用CleanWebpackPlugin清空output目录"><span class="toc-text">使用CleanWebpackPlugin清空output目录</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置resolve-alias"><span class="toc-text">配置resolve.alias</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#最终成果"><span class="toc-text">最终成果</span></a></li></ol>
        </div>
      </div>
    

    <div class="post-content">
      
        <p>此文基于<a href="https://webpack.js.org/" target="_blank" rel="external">webpack2</a>，做为个人稳定使用的一套webpack配置，记录下来，以供参考。<br><small><em><a href="https://github.com/mlxiao93/webpack-demo" target="_blank" rel="external">查看源码</a></em></small></p>
<a id="more"></a>
<h2 id="webpack概念"><a href="#webpack概念" class="headerlink" title="webpack概念"></a>webpack概念</h2><p>webpack是一个模块化打包工具，使用js作为载体将所有静态资源打包在一起，支持的loader和plugin等能对各种静态资源进行预处理，极大地方便了前端的工程化开发。详情参考<a href="https://webpack.js.org/" target="_blank" rel="external">官网</a>，此处放张官网概念图：</p>
<p><img src="http://o86lf0oxm.bkt.clouddn.com/webpack-concept.svg" alt="webpack"></p>
<h2 id="构建流程"><a href="#构建流程" class="headerlink" title="构建流程"></a>构建流程</h2><h3 id="环境要求"><a href="#环境要求" class="headerlink" title="环境要求"></a>环境要求</h3><p><a href="https://nodejs.org" target="_blank" rel="external">nodejs</a><br><small><em>tips: 装好nodejs后可以使用<a href="https://npm.taobao.org/" target="_blank" rel="external">淘宝NPM镜像</a>替代官方版本</em><br><code>npm install -g cnpm --registry=https://registry.npm.taobao.org</code></small></p>
<h3 id="项目初始化"><a href="#项目初始化" class="headerlink" title="项目初始化"></a>项目初始化</h3><h4 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h4><p>创建一个webpack-demo项目并生成package.json文件。<em>之后所有操作的根目录均为webpack-demo/</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mkdir webpack-demo</div><div class="line"><span class="built_in">cd</span> webpack-demo</div><div class="line">npm init <span class="_">-f</span></div></pre></td></tr></table></figure></p>
<h4 id="引入webpack2"><a href="#引入webpack2" class="headerlink" title="引入webpack2"></a>引入webpack2</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cnpm i -D webpack@beta</div></pre></td></tr></table></figure>
<p>  <img src="http://o86lf0oxm.bkt.clouddn.com/webpack-demo-01.png" alt="folder"></p>
<h4 id="项目初始结构分析"><a href="#项目初始结构分析" class="headerlink" title="项目初始结构分析"></a>项目初始结构分析</h4><ul>
<li>通常项目会分成三个运行环境：开发人员在本地跑的开发环境(dev)、测试人员用来做黑盒测试的测试环境(test)和线上运行的生产环境(production)。<br>简单起见，本文只考虑开发环境(dev)和生产环境(prod)，测试环境可以自行类比。</li>
<li><p>综上，webpack的配置需要有两套，同时两套配置必然会存在相同的部分，故新建目录与文件如下图：</p>
<p><img src="http://o86lf0oxm.bkt.clouddn.com/webpack-demo-03.png" alt="folder"></p>
<p>同时引入一个库<a href="https://github.com/survivejs/webpack-merge" target="_blank" rel="external">webpack-merge</a>用于合并base config和特定环境的config</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cnpm i -D webpack-merge</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="开始写webpack-config"><a href="#开始写webpack-config" class="headerlink" title="开始写webpack config"></a>开始写webpack config</h4><p>  <span class="filename">webpack-config/base.js<span><br>  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  <span class="comment">//common config</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure></span></span></p>
<p>  <span class="filename">webpack-config/dev.js, webpack-config/prod.js<span><br>  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> webpackMerge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>);</div><div class="line"><span class="keyword">const</span> base = <span class="built_in">require</span>(<span class="string">'./base'</span>);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = webpackMerge(base, &#123;</div><div class="line">  <span class="comment">//specific config</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure></span></span></p>
<p>  <span class="filename">webpack.config.js<span><br>  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> devModule = <span class="built_in">require</span>(<span class="string">'./webpack-config/dev'</span>);</div><div class="line"><span class="keyword">const</span> prodModule = <span class="built_in">require</span>(<span class="string">'./webpack-config/prod'</span>);</div><div class="line"></div><div class="line"><span class="keyword">let</span> finalModule = &#123;&#125;;</div><div class="line"></div><div class="line"><span class="keyword">let</span> ENV = process.env.NODE_ENV;     <span class="comment">//此处变量可由命令行传入</span></div><div class="line"></div><div class="line"><span class="keyword">switch</span> (ENV) &#123;</div><div class="line">  <span class="keyword">case</span> <span class="string">'dev'</span>:</div><div class="line">    finalModule = devModule;</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">  <span class="keyword">case</span> <span class="string">'prod'</span>:</div><div class="line">    finalModule = prodModule;</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">  <span class="keyword">default</span>:</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = finalModule;</div></pre></td></tr></table></figure></span></span></p>
<h4 id="编写npm-scripts，区分环境"><a href="#编写npm-scripts，区分环境" class="headerlink" title="编写npm scripts，区分环境"></a>编写<a href="http://www.ruanyifeng.com/blog/2016/10/npm_scripts.html" target="_blank" rel="external">npm scripts</a>，区分环境</h4><p>  <span class="filename">package.json<span><br>  <figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"webpack-demo"</span>,</div><div class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</div><div class="line">  <span class="attr">"scripts"</span>: &#123;</div><div class="line">    <span class="attr">"dev"</span>: <span class="string">"cross-env NODE_ENV=dev webpack"</span>,</div><div class="line">    <span class="attr">"prod"</span>: <span class="string">"cross-env NODE_env=prod webpack"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"devDependencies"</span>: &#123;</div><div class="line">    <span class="attr">"webpack"</span>: <span class="string">"^2.2.0"</span>,</div><div class="line">    <span class="attr">"webpack-merge"</span>: <span class="string">"^2.6.1"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></span></span></p>
<p>  由于*unix和windows设置NODE_ENV的语句有所<a href="http://stackoverflow.com/questions/9249830/how-can-i-set-node-env-production-in-windows" target="_blank" rel="external">差异</a>，此处用到了一个库<a href="https://github.com/kentcdodds/cross-env" target="_blank" rel="external">cross-env</a>以达到兼容的目的<br>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cnpm i -D cross-env</div></pre></td></tr></table></figure></p>
<h3 id="从dev环境写起"><a href="#从dev环境写起" class="headerlink" title="从dev环境写起"></a>从dev环境写起</h3><p>新建一个src目录用户存放项目源文件，同时在src下新建一个index.js作为打包的入口</p>
<h4 id="webpack-dev-server"><a href="#webpack-dev-server" class="headerlink" title="webpack-dev-server"></a>webpack-dev-server</h4><ul>
<li><p>安装<a href="https://webpack.js.org/guides/development/#webpack-dev-server" target="_blank" rel="external">webpack-dev-server</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cnpm i -D webpack-dev-server</div></pre></td></tr></table></figure>
</li>
<li><p>配置webpack config<br><span class="filename">webpack-config/dev.js<span></span></span></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">module.exports = webpackMerge(base, &#123;</div><div class="line">  entry: process.cwd() + &apos;/src/index.js&apos;,</div><div class="line">  output: &#123;</div><div class="line">    filename: &apos;[name].bundle.js&apos;</div><div class="line">  &#125;,</div><div class="line">  devtool: &apos;eval-source-map&apos;   //enable srouce map</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
<li><p>修改npm scripts<br><span class="filename">package.json<span></span></span></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line"> ...</div><div class="line"> &quot;scripts&quot;: &#123;</div><div class="line">   &quot;dev&quot;: &quot;cross-env NODE_ENV=dev webpack-dev-server --inline --hot --host 0.0.0.0&quot;,</div><div class="line">   ...</div><div class="line"> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="htmlWebpackPlugins"><a href="#htmlWebpackPlugins" class="headerlink" title="htmlWebpackPlugins"></a>htmlWebpackPlugins</h4><p>src目录下新建一个index.html作为template，htmlWebpackPlugins会根据这个template生成网站的index.html，同时自动写入bundle依赖。<br>src下放一个favicon.ico作为网站的icon</p>
<ul>
<li><p>安装<a href="https://webpack.js.org/plugins/html-webpack-plugin/" target="_blank" rel="external">htmlWebpackPlugins</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cnpm i -D html-webpack-plugin</div></pre></td></tr></table></figure>
</li>
<li><p>配置webpack config<br><span class="filename">webpack-config/dev.js<span></span></span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">const HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</div><div class="line">...</div><div class="line">module.exports = webpackMerge(base, &#123;</div><div class="line">  ...</div><div class="line">  plugins: [</div><div class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</div><div class="line">      <span class="attr">filename</span>: <span class="string">'index.html'</span>,</div><div class="line">      <span class="attr">template</span>: process.cwd() + <span class="string">'/src/index.html'</span>,</div><div class="line">      <span class="attr">favicon</span>: process.cwd() + <span class="string">'/src/index.html'</span></div><div class="line">    &#125;)</div><div class="line">  ]</div><div class="line">  ...</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<p>到这一步算是完成了最基本的开发环境配置，命令行执行<code>npm run dev</code>，然后浏览器打开localhost:8080就能看到成果<br>将npm scripts中的<a href="https://docs.npmjs.com/cli/start" target="_blank" rel="external">start命令</a>指向npm run dev，这样每次开始开发只需要执行<code>npm start</code><br><span class="filename">package.json<span><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  ...</div><div class="line">  &quot;scripts&quot;: &#123;</div><div class="line">    ...</div><div class="line">    &quot;start&quot;: &quot;npm run dev&quot;</div><div class="line">    ...</div><div class="line">  &#125;</div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure></span></span></p>
<h4 id="Loaders-Rules"><a href="#Loaders-Rules" class="headerlink" title="Loaders(Rules)"></a>Loaders(Rules)</h4><p>webpack本身只能处理js模块，如果需要处理其他类型的文件，就需要<a href="https://webpack.js.org/concepts/loaders/" target="_blank" rel="external">Loaders</a>进行转换</p>
<h5 id="ES6-支持"><a href="#ES6-支持" class="headerlink" title="ES6+支持"></a>ES6+支持</h5><p>ES6+虽然不能直接被浏览器全部识别，但是能用babel转换成ES5代码。</p>
<ul>
<li><p>安装babel编译相关依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cnpm i -D babel-core babel-preset-latest babel-preset-stage-2 babel-runtime babel-plugin-transform-runtime babel-loader</div></pre></td></tr></table></figure>
</li>
<li><p>新建.babelrc文件并写入:<br><span class="filename">.babelrc<span></span></span></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;presets&quot;: [&quot;latest&quot;, &quot;stage-2&quot;],</div><div class="line">  &quot;plugins&quot;: [&quot;transform-runtime&quot;]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>配置rules<br><span class="filename">webpack-config/dev.js<span></span></span></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">module.exports = webpackMerge(base, &#123;</div><div class="line">  ...</div><div class="line">  module: &#123;</div><div class="line">    rules: [</div><div class="line">      ...</div><div class="line">      &#123;</div><div class="line">        test: /\.js$/,</div><div class="line">        exclude: [/node_modules/],</div><div class="line">        loader: &apos;babel-loader&apos;</div><div class="line">      &#125;</div><div class="line">      ...</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">  ...</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="css处理"><a href="#css处理" class="headerlink" title="css处理"></a>css处理</h5><p>现如今css预处理器已经成为前端开发的标配，<a href="http://sass-lang.com/" target="_blank" rel="external">Sass(Scss)</a>,<a href="http://lesscss.org/" target="_blank" rel="external">Less</a>和<a href="http://stylus-lang.com/" target="_blank" rel="external">Stylus</a>各行其道，个人偏好scss。<br><a href="http://postcss.org/" target="_blank" rel="external">PostCss</a>可以作为一个后处理器，实现为css自动添加浏览器前缀等功能</p>
<ul>
<li><p>安装相关依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cnpm i -D style-loader css-loader postcss-loader autoprefixer node-sass sass-loader</div></pre></td></tr></table></figure>
</li>
<li><p>新建postcss.config.js<br><span class="filename">postcss.config.js<span></span></span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  <span class="attr">plugins</span>: [</div><div class="line">    <span class="built_in">require</span>(<span class="string">'autoprefixer'</span>)(&#123;<span class="attr">browsers</span>: [<span class="string">'last 2 versions'</span>, <span class="string">'iOS 7'</span>, <span class="string">'Firefox &gt; 20'</span>]&#125;)</div><div class="line">  ]</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
<li><p>配置rules<br><span class="filename">webpack-config/dev.js<span></span></span></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">module.exports = webpackMerge(base, &#123;</div><div class="line">  ...</div><div class="line">  module: &#123;</div><div class="line">    rules: [</div><div class="line">      ...</div><div class="line">      &#123;</div><div class="line">        test: /\.scss$/,</div><div class="line">        exclude: [/node_modules/],</div><div class="line">        use: [</div><div class="line">          &apos;style-loader&apos;,</div><div class="line">          &#123;</div><div class="line">            loader: &apos;css-loader&apos;,</div><div class="line">            options: &#123;</div><div class="line">              sourceMap: true</div><div class="line">            &#125;</div><div class="line">          &#125;,</div><div class="line">          &apos;postcss-loader&apos;,</div><div class="line">          &#123;</div><div class="line">            loader: &apos;sass-loader&apos;,</div><div class="line">            options: &#123;</div><div class="line">              sourceMap: true</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">        ]</div><div class="line">      &#125;</div><div class="line">      ...</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">  ...</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="html模板、图片等的处理"><a href="#html模板、图片等的处理" class="headerlink" title="html模板、图片等的处理"></a>html模板、图片等的处理</h5><ul>
<li><p>安装相关依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cnpm i -D html-loader file-loader url-loader</div></pre></td></tr></table></figure>
</li>
<li><p>配置rules<br><span class="filename">webpack-config/dev.js<span></span></span></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">module.exports = webpackMerge(base, &#123;</div><div class="line">  ...</div><div class="line">  module: &#123;</div><div class="line">    rules: [</div><div class="line">      ...</div><div class="line">      &#123;</div><div class="line">        test: /\.html$/,</div><div class="line">        loader: &apos;html-loader&apos;,</div><div class="line">        options: &#123;</div><div class="line">          minimize: true</div><div class="line">        &#125;</div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        test: /\.(jpe?g|png|gif|svg)$/i,</div><div class="line">        loader: &apos;url-loader&apos;,</div><div class="line">        options: &#123;</div><div class="line">          limit: 10000,</div><div class="line">          hash: &apos;sha512&apos;,</div><div class="line">          publicPath: &apos;/&apos;,</div><div class="line">          name: &apos;assets/images/[hash].[ext]&apos;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">      ...</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">  ...</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>至此，dev环境配置完成</strong></p>
<h3 id="配置production环境"><a href="#配置production环境" class="headerlink" title="配置production环境"></a>配置production环境</h3><h4 id="抽出公共部分"><a href="#抽出公共部分" class="headerlink" title="抽出公共部分"></a>抽出公共部分</h4><ul>
<li><p>entry可以共用，prod的output需要加上文件chunkhash用来刷新缓存,并将文件输出至dist目录<br><span class="filename">webpack-config/dev.js<span></span></span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- entry: process.cwd() + <span class="string">'/src/index.js'</span>,</div></pre></td></tr></table></figure>
<p><span class="filename">webpack-config/base.js<span></span></span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  <span class="attr">entry</span>: process.cwd() + <span class="string">'/src/index.js'</span>,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p><span class="filename">webpack-config/prod.js<span></span></span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> webpackMerge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>);</div><div class="line"><span class="keyword">const</span> base = <span class="built_in">require</span>(<span class="string">'./base'</span>);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = webpackMerge(base, &#123;</div><div class="line">  <span class="attr">output</span>: &#123;</div><div class="line">    <span class="attr">filename</span>: <span class="string">'bundle.[chunkhash].js'</span>,</div><div class="line">    <span class="attr">path</span>: process.cwd() + <span class="string">'/dist'</span></div><div class="line">  &#125;,</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
<li><p>HtmlWebpackPlugin公共<br><span class="filename">webpack-config/dev.js<span></span></span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">-<span class="keyword">new</span> HtmlWebpackPlugin(&#123;</div><div class="line">-  filename: <span class="string">'index.html'</span>,</div><div class="line">-  template: process.cwd() + <span class="string">'/src/index.html'</span>,</div><div class="line">-  favicon: process.cwd() + <span class="string">'/src/index.html'</span></div><div class="line">-&#125;)</div></pre></td></tr></table></figure>
<p><span class="filename">webpack-config/base.js<span></span></span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  ...</div><div class="line">  plugins: [</div><div class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</div><div class="line">      <span class="attr">filename</span>: <span class="string">'index.html'</span>,</div><div class="line">      <span class="attr">template</span>: process.cwd() + <span class="string">'/src/index.html'</span>,</div><div class="line">      <span class="attr">favicon</span>: process.cwd() + <span class="string">'/src/index.html'</span></div><div class="line">    &#125;)</div><div class="line">  ],</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
<li><p>js、html和图片loader公共，prod的css loader需要使用<a href="https://webpack.js.org/guides/code-splitting-css/#using-extract-text-webpack-plugin-extracttextplugin" target="_blank" rel="external">ExtractTextPlugin</a>将css从js中分离出来<br><span class="filename">webpack-config/dev.js<span></span></span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">-&#123;</div><div class="line">-  test: <span class="regexp">/\.js$/</span>,</div><div class="line">-  exclude: [<span class="regexp">/node_modules/</span>],</div><div class="line">-  loader: <span class="string">'babel-loader'</span></div><div class="line">-&#125;</div><div class="line">...</div><div class="line">-&#123;</div><div class="line">-  test: <span class="regexp">/\.html$/</span>,</div><div class="line">-  loader: <span class="string">'html-loader'</span>,</div><div class="line">-  options: &#123;</div><div class="line">-    minimize: <span class="literal">true</span></div><div class="line">-  &#125;</div><div class="line">-&#125;,</div><div class="line">-&#123;</div><div class="line">-  test: <span class="regexp">/\.(jpe?g|png|gif|svg)$/i</span>,</div><div class="line">-  loader: <span class="string">'url-loader'</span>,</div><div class="line">-  options: &#123;</div><div class="line">-    limit: <span class="number">10000</span>,</div><div class="line">-    hash: <span class="string">'sha512'</span>,</div><div class="line">-    publicPath: <span class="string">'/'</span>,</div><div class="line">-    name: <span class="string">'assets/images/[hash].[ext]'</span></div><div class="line">-  &#125;</div><div class="line">-&#125;</div></pre></td></tr></table></figure>
<p><span class="filename">webpack-config/base.js<span></span></span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">module.exports = &#123;</div><div class="line">  ...</div><div class="line">  module: &#123;</div><div class="line">    <span class="attr">rules</span>: [</div><div class="line">      &#123;</div><div class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</div><div class="line">        <span class="attr">exclude</span>: [<span class="regexp">/node_modules/</span>],</div><div class="line">        <span class="attr">loader</span>: <span class="string">'babel-loader'</span></div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        <span class="attr">test</span>: <span class="regexp">/\.html$/</span>,</div><div class="line">        <span class="attr">loader</span>: <span class="string">'html-loader'</span>,</div><div class="line">        <span class="attr">options</span>: &#123;</div><div class="line">          <span class="attr">minimize</span>: <span class="literal">true</span></div><div class="line">        &#125;</div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        <span class="attr">test</span>: <span class="regexp">/\.(jpe?g|png|gif|svg)$/i</span>,</div><div class="line">        <span class="attr">loader</span>: <span class="string">'url-loader'</span>,</div><div class="line">        <span class="attr">options</span>: &#123;</div><div class="line">          <span class="attr">limit</span>: <span class="number">10000</span>,</div><div class="line">          <span class="attr">hash</span>: <span class="string">'sha512'</span>,</div><div class="line">          <span class="attr">publicPath</span>: <span class="string">'/'</span>,</div><div class="line">          <span class="attr">name</span>: <span class="string">'assets/images/[hash].[ext]'</span></div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cnpm i -D extract-text-webpack-plugin@beta</div></pre></td></tr></table></figure>
<p><span class="filename">webpack-config/prod.js<span></span></span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">const ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">"extract-text-webpack-plugin"</span>);</div><div class="line">...</div><div class="line">module: &#123;</div><div class="line">  <span class="attr">rules</span>: [</div><div class="line">    &#123;</div><div class="line">      <span class="attr">test</span>: <span class="regexp">/\.scss$/</span>,</div><div class="line">      <span class="attr">exclude</span>: [<span class="regexp">/node_modules/</span>],</div><div class="line">      <span class="attr">use</span>: ExtractTextPlugin.extract(&#123;</div><div class="line">        <span class="attr">fallback</span>: <span class="string">'style-loader'</span>,</div><div class="line">        <span class="attr">use</span>: [</div><div class="line">          &#123;</div><div class="line">            <span class="attr">loader</span>: <span class="string">'css-loader'</span>,</div><div class="line">            <span class="attr">options</span>: &#123;</div><div class="line">              <span class="attr">minimize</span>: <span class="literal">true</span></div><div class="line">            &#125;</div><div class="line">          &#125;,</div><div class="line">          <span class="string">'postcss-loader'</span>,</div><div class="line">          <span class="string">'sass-loader'</span></div><div class="line">        ]</div><div class="line">      &#125;)</div><div class="line">    &#125;</div><div class="line">  ]</div><div class="line">&#125;,</div><div class="line">...</div><div class="line">plugins: [</div><div class="line">  <span class="keyword">new</span> ExtractTextPlugin(&#123;</div><div class="line">    <span class="attr">filename</span>: <span class="string">"bundle.[chunkhash].css"</span></div><div class="line">  &#125;)</div><div class="line">],</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="production环境的其它处理"><a href="#production环境的其它处理" class="headerlink" title="production环境的其它处理"></a>production环境的其它处理</h4><h5 id="使用UglifyJsPlugin压缩js"><a href="#使用UglifyJsPlugin压缩js" class="headerlink" title="使用UglifyJsPlugin压缩js"></a>使用<a href="https://webpack.js.org/plugins/uglifyjs-webpack-plugin/#uglifyjs-webpack-plugin" target="_blank" rel="external">UglifyJsPlugin</a>压缩js</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cnpm i - D uglifyjs-webpack-plugin</div></pre></td></tr></table></figure>
<p><span class="filename">webpack-config/prod.js<span><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">const UglifyJSPlugin = <span class="built_in">require</span>(<span class="string">'uglifyjs-webpack-plugin'</span>);</div><div class="line">...</div><div class="line">module.exports = webpackMerge(base, &#123;</div><div class="line">  ...</div><div class="line">  const webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</div><div class="line">  ...</div><div class="line">  plugins: [</div><div class="line">    ...</div><div class="line">    new UglifyJSPlugin(&#123;</div><div class="line">      <span class="attr">compress</span>: &#123;</div><div class="line">        <span class="attr">warnings</span>: <span class="literal">false</span>,</div><div class="line">      &#125;,</div><div class="line">      <span class="attr">output</span>: &#123;</div><div class="line">        <span class="attr">comments</span>: <span class="literal">false</span></div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line">    ...</div><div class="line">  ]</div><div class="line">  ...</div><div class="line">&#125;)</div><div class="line">...</div></pre></td></tr></table></figure></span></span></p>
<h5 id="使用CleanWebpackPlugin清空output目录"><a href="#使用CleanWebpackPlugin清空output目录" class="headerlink" title="使用CleanWebpackPlugin清空output目录"></a>使用<a href="https://github.com/johnagan/clean-webpack-plugin" target="_blank" rel="external">CleanWebpackPlugin</a>清空output目录</h5><p>构建前先清空，防止出现垃圾文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cnpm i -D clean-webpack-plugin</div></pre></td></tr></table></figure></p>
<p><span class="filename">webpack-config/prod.js<span><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">module.exports = webpackMerge(base, &#123;</div><div class="line">  ...</div><div class="line">  plugins: [</div><div class="line">    ...</div><div class="line">    const CleanWebpackPlugin = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>);</div><div class="line">    ...</div><div class="line">    new CleanWebpackPlugin([<span class="string">'dist'</span>], &#123;</div><div class="line">      <span class="attr">root</span>: process.cwd(),</div><div class="line">      <span class="attr">exclude</span>: []</div><div class="line">    &#125;)</div><div class="line">    ...</div><div class="line">  ]</div><div class="line">  ...</div><div class="line">&#125;)</div><div class="line">...</div></pre></td></tr></table></figure></span></span></p>
<p><strong>至此，production环境配置完毕，同时抽出了公共部分</strong></p>
<h3 id="配置resolve-alias"><a href="#配置resolve-alias" class="headerlink" title="配置resolve.alias"></a>配置<a href="https://webpack.js.org/configuration/resolve/#resolve-alias" target="_blank" rel="external">resolve.alias</a></h3><ul>
<li><p>开发的时候如果有一个很深的目录比如：src/a/b/c/d/, 然后在d目录下的一个模块需要引入a目录下的模块，需要这样写：<code>import &#39;../../../some-module&#39;</code>，为了方便可以配置一个为src目录配置一个alias，这样模块引入只需要这样写：<code>import src/a/some-module</code>。<br><span class="filename">webpack-config/base.js<span></span></span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">const path = <span class="built_in">require</span>(<span class="string">'path'</span>);</div><div class="line">...</div><div class="line">module.exports = &#123;</div><div class="line">  ...</div><div class="line">  resolve: &#123;</div><div class="line">    <span class="attr">extensions</span>: [<span class="string">'.js'</span>],</div><div class="line">    <span class="attr">alias</span>: &#123;</div><div class="line">      <span class="attr">src</span>: path.resolve(__dirname, <span class="string">'./../src'</span>)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  ...</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
<li><p>通常dev环境和production环境的配置参数比如api domain会有差异，所以需要利用alias将用户两个环境配置文件区分开来<br><em>src目录下新建config目录，src/config目录下新增三个文件：base.js、dev.js、prod.js</em><br><span class="filename">webpack-config/base.js<span></span></span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</div><div class="line">  <span class="attr">version</span>: <span class="string">'1.0.0'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><span class="filename">webpack-config/dev.js<span></span></span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> base <span class="keyword">from</span> <span class="string">'./base'</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</div><div class="line">  ...base,</div><div class="line">  <span class="attr">env</span>: <span class="string">'dev'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><span class="filename">webpack-config/prod.js<span></span></span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> base <span class="keyword">from</span> <span class="string">'./base'</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</div><div class="line">  ...base,</div><div class="line">  <span class="attr">env</span>: <span class="string">'prod'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><em>配置alias</em><br><span class="filename">webpack-config/dev.js<span></span></span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">const path = <span class="built_in">require</span>(<span class="string">'path'</span>);</div><div class="line">...</div><div class="line">module.exports = webpackMerge(base, &#123;</div><div class="line">  ...</div><div class="line">  resolve: &#123;</div><div class="line">    <span class="attr">alias</span>: &#123;</div><div class="line">      <span class="attr">config</span>: path.resolve(__dirname, <span class="string">'./../src/config/dev.js'</span>)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  ...</div><div class="line">&#125;)</div><div class="line">...</div></pre></td></tr></table></figure>
<p><span class="filename">webpack-config/prod.js<span></span></span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">const path = <span class="built_in">require</span>(<span class="string">'path'</span>);</div><div class="line">...</div><div class="line">module.exports = webpackMerge(base, &#123;</div><div class="line">  ...</div><div class="line">  resolve: &#123;</div><div class="line">    <span class="attr">alias</span>: &#123;</div><div class="line">      <span class="attr">config</span>: path.resolve(__dirname, <span class="string">'./../src/config/prod.js'</span>)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  ...</div><div class="line">&#125;)</div><div class="line">...</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="最终成果"><a href="#最终成果" class="headerlink" title="最终成果"></a>最终成果</h2><p><a href="https://github.com/mlxiao93/webpack-demo" target="_blank" rel="external">https://github.com/mlxiao93/webpack-demo</a></p>

      
    </div>

    
      <footer class="post-footer">
        <div class="post-tags">
          
            <a href="/tags/js/">js</a>
          
            <a href="/tags/webpack/">webpack</a>
          
            <a href="/tags/tool/">tool</a>
          
        </div>

        
  <nav class="post-nav">
    
      <a class="prev" href="/2017/02/09/node-babel/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">为nodejs配置babel</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2017/02/07/css-flex/">
        <span class="next-text nav-default">css3 flex</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

      </footer>
    
  </article>


          </div>
          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2017/02/08/webpack/"
           data-title="使用webpack构建项目" data-url="http://mlxiao.com/2017/02/08/webpack/">
      </div>
    
  </div>


        </div>  
      </main>

      <footer id="footer" class="footer">
  <div class="social-links">
    
      
        
          <a href="mailto:martin.xiao.cn@gmail.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
        
          <a href="https://github.com/mlxiao93" target="_blank" class="iconfont icon-github" title="github"></a>
        
      
    
      
    
      
    

    
  </div>


<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" target="_blank" href="https://hexo.io/">Hexo</a>
  </span>

  <span class="theme-info">
    Theme -
    <a class="theme-link" target="_blank"  href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy;
    
    2017

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">m.l xiao</span>
  </span>
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"mlxiao"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>



    
  





  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  

    <script type="text/javascript" src="/js/src/even.js?v=2.1.x"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.1.x"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

  </body>
</html>